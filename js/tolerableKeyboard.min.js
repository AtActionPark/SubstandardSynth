(function(){function a(m){let o=m.slice(-1),p=m.slice(0,-1),q='B'==p?parseInt(o)+1:o,r=Object.keys(k),s=r.indexOf(p)+1,t='B'==p?'C':r[s];return t+q}function b(m){let o=m.slice(-1),p=m.slice(0,-1);return k[p]*Math.pow(2,o-3)}function e(m,o){return Object.keys(m).find(p=>m[p]===o)}function f(m,o){let p=document.getElementById(m),q=p.getElementsByTagName('div');for(let r=0;r<q.length;r++)if(q[r].id==o)return q[r]}let g=!1,h={},j;const k={C:261.626,'C#':277.183,D:293.665,'D#':311.127,E:329.628,F:349.228,'F#':369.994,G:391.995,'G#':415.305,A:440,'A#':466.164,B:493.883},l={0:0,1:0,2:1,3:1,4:2,5:3,6:3,7:4,8:4,9:5,10:5,11:6};TolerableKeyboard=function(m){m==void 0&&(m={}),this.keyboardMap={},this.keysMap={A:'C3',S:'D3',D:'E3',F:'F3',G:'G3',H:'A3',J:'B3',K:'C4',W:'C#3',E:'D#3',T:'F#3',Y:'G#3',U:'A#3'},this.divID=m.divID||'tolerableKeyboard',this.octaves=m.octaves||3,this.width=m.width||800,this.borderSize=m.borderSize||0,this.borderSizeTop=m.borderSizeTop||0,this.borderSizeOffset=m.borderSizeOffset||0,this.borderColor=m.borderColor||'black',this.borderBorderSize=m.borderBorderSize||0,this.borderBorderColor=m.borderBorderColor||'black',this.borderRadius=m.borderRadius||20,this.borderText=m.borderText||'',this.noteWidth=(this.width-2*this.borderSize)/(7*this.octaves+1),this.noteHeight=m.height||200,this.firstNote=m.firstNote||'C2',this.showKey=m.showKey||!1,this.autoSetUp=!(void 0!=m.autoSetUp)||m.autoSetUp,this.selectColor=m.selectColor||'#7FDBFF',this.whiteNoteColor=m.whiteNoteColor||'white',this.blackNoteColor=m.blackNoteColor||'black',this.autoSetUp&&(this.context=new AudioContext,this.mixNode=this.context.createGain(),this.mixNode.gain.value=0.3,this.mixNode.connect(this.context.destination),this.nodes=[]),this.init()},TolerableKeyboard.prototype.init=function(){let m=document.getElementById(this.divID);if(null==m){let y=document.createElement('div');y.id=this.divID,document.body.appendChild(y)}let o=document.getElementById(this.divID);o.innerHTML='',o.style.height=this.noteHeight+this.borderSizeTop+'px',o.style.width=this.width+'px';let p=this.firstNote.slice(0,-1),q=p.slice(-1),r,s=this.firstNote;for(let y=0;12>y;y++)Object.keys(k)[y]==p&&(r=y);this.keyboardMap={},this.keyboardMap[r]=s;for(let y=r+1;y<13*this.octaves+r;y++)this.keyboardMap[y]=a(s),s=this.keyboardMap[y];let t=document.createElement('ul');t.style.margin='0px',t.style.listStyle='none',t.style.position='relative',t.ondragstart=function(){return!1},t.ondrop=function(){return!1},o.appendChild(t);let u='#'==q?-this.noteWidth/2:0,v=0;for(let y=0;y<7*this.octaves+l[r]+1;y++){if(v>=r&&(y<7*this.octaves+l[r]+1||'#'==q)){let z=document.createElement('li');z.appendChild(this.createNote('white',this.noteWidth*y-u+this.borderSize+this.borderBorderSize,v)),t.appendChild(z)}else u+=this.noteWidth;if(v++,2!=y%7&&6!=y%7){if(v>=r&&y<7*this.octaves+l[r]+('#'==q?1:0)){let z=document.createElement('li');z.appendChild(this.createNote('black',this.noteWidth*y+2*(this.noteWidth/3)-u+this.borderSize+this.borderBorderSize,v)),t.appendChild(z)}v++}}if(0<this.borderSize||0<this.borderSizeTop){let y=document.createElement('div');y.classList.add('tolerableKeyboardTop'),y.innerHTML=this.borderText,y.style.zIndex=-100,y.style.textAlign='center',y.style.fontWeight='bold',y.style.fontSize=5*this.borderSizeTop/6+'px',y.style.userSelect='none',y.style.webkitUserSelect='none',y.style.MozUserSelect='none',y.style.color=this.borderBorderColor,y.style.width=this.width+this.borderBorderSize-3+'px',y.style.height=this.noteHeight+this.borderSizeTop-1*this.borderBorderSize+this.borderSizeOffset+'px',y.style.backgroundColor=this.borderColor,y.style.borderTop=this.borderBorderSize+'px solid '+this.borderBorderColor,y.style.borderRight=this.borderBorderSize+'px solid '+this.borderBorderColor,y.style.borderLeft=this.borderBorderSize+'px solid '+this.borderBorderColor,y.style.borderBottom=this.borderBorderSize+'px solid '+this.borderBorderColor,y.style.borderTopLeftRadius=this.borderRadius+'px',y.style.borderTopRightRadius=this.borderRadius+'px',y.style.borderBottomLeftRadius=this.borderRadius+'px',y.style.borderBottomRightRadius=this.borderRadius+'px',o.appendChild(y)}let w=this,x=document.getElementById(this.divID).getElementsByClassName('note');for(let y=0;y<x.length;y++)x[y].onmousedown=function(){g=!0,w.onPressNoteID(this.id)},x[y].onmouseup=function(){w.onReleaseNoteID(this.id)},x[y].onmouseover=function(){g&&w.onPressNoteID(this.id)},x[y].onmouseout=function(){!g||this.classList.contains('played')&&w.onReleaseNoteID(this.id)};document.onmouseup=function(){g=!1},document.onkeydown=function(y){if(j=y.keyCode||window.event,!(j in h)){h[j]=!0;let z=String.fromCharCode(j);w.onPressNoteID(e(w.keyboardMap,w.keysMap[z]))}},document.onkeyup=function(y){j=y.keyCode||window.event,delete h[j];let z=String.fromCharCode(j);z in w.keysMap&&w.onReleaseNoteID(e(w.keyboardMap,w.keysMap[z]))}},TolerableKeyboard.prototype.createNote=function(m,o,p){let q=document.createElement('div');if(q.id=p,q.classList.add('note'),q.classList.add(m),q.style.position='absolute',q.style.left=o+'px',q.style.top=this.borderSizeTop+this.borderBorderSize+'px',q.style.width=('white'==m?this.noteWidth:2*this.noteWidth/3)+'px',q.style.height=('white'==m?this.noteHeight:5.5*this.noteHeight/9)+'px',q.style.backgroundColor='white'==m?this.whiteNoteColor:this.blackNoteColor,q.style.zIndex='black'==m?10:0,q.style.border='1px solid black',q.style.borderBottomLeftRadius='5px',q.style.borderBottomRightRadius='5px',this.showKey){let r=e(this.keysMap,this.keyboardMap[p]);void 0==r&&(r='');let s=document.createElement('div');s.innerHTML=r,s.style.userSelect='none',s.style.webkitUserSelect='none',s.style.MozUserSelect='none',s.style.color='white'==m?this.blackNoteColor:this.whiteNoteColor,s.style.position='absolute',s.style.bottom=0,s.style.padding=('white'==m?this.noteWidth/3:this.noteWidth/6)+'px',q.appendChild(s)}return q},TolerableKeyboard.prototype.onPressNoteID=function(m){if('undefined'!=typeof this.keyboardMap[m]){let o=f(this.divID,m);o.style.backgroundColor=this.selectColor,o.classList.add('played');let p=b(this.keyboardMap[m]);this.pressNote(p)}},TolerableKeyboard.prototype.pressNote=function(m){if(this.autoSetUp){let o=this.context.createOscillator();o.type='square',o.frequency.value=m,o.connect(this.mixNode),o.start(0),this.nodes.push(o)}},TolerableKeyboard.prototype.onReleaseNoteID=function(m){if('undefined'!=typeof this.keyboardMap[m]){let o=f(this.divID,m),p=o.classList.contains('white')?'white':'black';o.style.backgroundColor='white'==p?this.whiteNoteColor:this.blackNoteColor,o.classList.remove('played');let q=b(this.keyboardMap[m]);this.releaseNote(q)}},TolerableKeyboard.prototype.releaseNote=function(m){if(this.autoSetUp){let o=[];for(let p=0;p<this.nodes.length;p++)Math.round(this.nodes[p].frequency.value)===Math.round(m)?(this.nodes[p].stop(0),this.nodes[p].disconnect()):o.push(this.nodes[p]);this.nodes=o}},TolerableKeyboard.prototype.addKeyBinding=function(m,o){this.keysMap[m]=o,this.init()}})();
